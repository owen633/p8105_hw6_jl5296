HW 6
================
Jianyou Liu
November 25, 2018

Problem 1
---------

### Load in dataset

``` r
raw_hom_data = read.csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")

head(raw_hom_data)
```

    ##          uid reported_date victim_last victim_first victim_race victim_age
    ## 1 Alb-000001      20100504      GARCIA         JUAN    Hispanic         78
    ## 2 Alb-000002      20100216     MONTOYA      CAMERON    Hispanic         17
    ## 3 Alb-000003      20100601 SATTERFIELD      VIVIANA       White         15
    ## 4 Alb-000004      20100101    MENDIOLA       CARLOS    Hispanic         32
    ## 5 Alb-000005      20100102        MULA       VIVIAN       White         72
    ## 6 Alb-000006      20100126        BOOK    GERALDINE       White         91
    ##   victim_sex        city state      lat       lon           disposition
    ## 1       Male Albuquerque    NM 35.09579 -106.5386 Closed without arrest
    ## 2       Male Albuquerque    NM 35.05681 -106.7153      Closed by arrest
    ## 3     Female Albuquerque    NM 35.08609 -106.6956 Closed without arrest
    ## 4       Male Albuquerque    NM 35.07849 -106.5561      Closed by arrest
    ## 5     Female Albuquerque    NM 35.13036 -106.5810 Closed without arrest
    ## 6     Female Albuquerque    NM 35.15111 -106.5378        Open/No arrest

#### Create city\_state variable and binary variable indicating whether the homicide is solved

``` r
new_hom_data1 = raw_hom_data %>% 
  unite(city, state, col = "city_state", sep = ",") %>% 
  mutate(bin_solved = ifelse(disposition == "Closed without arrest" | disposition == "Open/No arrest", 0, 1))
```

**Note**: '0' = crime unsolved; '1' = crime solved

#### Omit cities Dallas, TX; Phoenix, AZ; and Kansas City, MO – these don’t report victim race. Also omit Tulsa, AL – this is a data entry mistake

``` r
new_hom_data2 = new_hom_data1 %>% 
  filter(city_state != "Dallas,TX", city_state != "Phoenix,AZ", city_state != "Kansas City,MO", city_state != "Tulsa,AL")
```

#### Modifiy victim\_race to have categories white and non-white, with white as the reference category. Make sure that victim\_age is a numeric variable.

``` r
final_hom_data = new_hom_data2 %>% 
  mutate(victim_race = ifelse(victim_race == "White", "White", "Non-White"),
  # Make 'White' as the reference category
  victim_race = fct_relevel(victim_race, ref = "White")) %>% 
  # Convert 'victim_age' into numeric
  mutate(victim_age = as.numeric(victim_age))

head(final_hom_data, n = 10)
```

    ##           uid reported_date  victim_last victim_first victim_race
    ## 1  Alb-000001      20100504       GARCIA         JUAN   Non-White
    ## 2  Alb-000002      20100216      MONTOYA      CAMERON   Non-White
    ## 3  Alb-000003      20100601  SATTERFIELD      VIVIANA       White
    ## 4  Alb-000004      20100101     MENDIOLA       CARLOS   Non-White
    ## 5  Alb-000005      20100102         MULA       VIVIAN       White
    ## 6  Alb-000006      20100126         BOOK    GERALDINE       White
    ## 7  Alb-000007      20100127    MALDONADO        DAVID   Non-White
    ## 8  Alb-000008      20100127    MALDONADO       CONNIE   Non-White
    ## 9  Alb-000009      20100130 MARTIN-LEYVA      GUSTAVO       White
    ## 10 Alb-000010      20100210      HERRERA       ISRAEL   Non-White
    ##    victim_age victim_sex     city_state      lat       lon
    ## 1          79       Male Albuquerque,NM 35.09579 -106.5386
    ## 2          12       Male Albuquerque,NM 35.05681 -106.7153
    ## 3          10     Female Albuquerque,NM 35.08609 -106.6956
    ## 4          29       Male Albuquerque,NM 35.07849 -106.5561
    ## 5          73     Female Albuquerque,NM 35.13036 -106.5810
    ## 6          94     Female Albuquerque,NM 35.15111 -106.5378
    ## 7          51       Male Albuquerque,NM 35.11178 -106.7126
    ## 8          51     Female Albuquerque,NM 35.11178 -106.7126
    ## 9          55       Male Albuquerque,NM 35.07538 -106.5535
    ## 10         41       Male Albuquerque,NM 35.06593 -106.5723
    ##              disposition bin_solved
    ## 1  Closed without arrest          0
    ## 2       Closed by arrest          1
    ## 3  Closed without arrest          0
    ## 4       Closed by arrest          1
    ## 5  Closed without arrest          0
    ## 6         Open/No arrest          0
    ## 7       Closed by arrest          1
    ## 8       Closed by arrest          1
    ## 9         Open/No arrest          0
    ## 10        Open/No arrest          0

### Baltimore, MD Linear Model Analysis

#### Fit logistic regression with resolved vs unresolved as the outcome and victim age, sex and race as predictors.

``` r
balt_data = final_hom_data %>% 
  filter(city_state == "Baltimore,MD")

# Save output as R object
fit_glm_balt = balt_data %>% 
  glm(bin_solved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())
```

#### Apply broom::tidy to the object and extract estimate and confidence interval of the adjusted odds ratio

``` r
fit_glm_balt %>% 
  broom::tidy() %>% 
  # Transform log 'Odds Ratio' back
  mutate(OR = exp(estimate), low_CI = exp(estimate - std.error*1.96), high_CI = exp(estimate + std.error*1.96)) %>% 
  select(term, OR, low_CI, high_CI, p.value) %>% 
  filter(term == "victim_raceNon-White") %>% 
  knitr::kable(digits = 3)
```

| term                  |     OR|  low\_CI|  high\_CI|  p.value|
|:----------------------|------:|--------:|---------:|--------:|
| victim\_raceNon-White |  0.453|    0.322|     0.637|        0|
